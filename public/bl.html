<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>全球时间对照</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: #fff;
      text-align: center;
    }

    h1 {
      margin-top: 20px;
      font-size: 2.5rem;
    }

    .controls {
      margin: 20px auto;
      max-width: 1200px;
      display: grid;
      grid-template-rows: auto auto auto;
      gap: 15px;
      padding: 0 20px;
    }

    .time-controls {
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    .city-controls {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
    }

    .lang-control {
      display: flex;
      gap: 10px;
      justify-content: center;
      align-items: center;
    }

    select, input[type="datetime-local"], button {
      padding: 10px;
      font-size: 1rem;
      border-radius: 8px;
      border: none;
      min-width: 180px;
    }

    button {
      background-color: #4db6ac;
      color: white;
      cursor: pointer;
    }

    .card-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-bottom: 40px;
    }

    .time-card {
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 12px;
      width: 300px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }

    .time-card h2 {
      margin-bottom: 10px;
    }

    .time-display {
      font-size: 2rem;
      margin: 10px 0;
    }

    .date-info {
      font-size: 1.1rem;
      color: #bbdefb;
    }

    .diff-info {
      font-size: 1rem;
      color: #ffd54f;
      margin-top: 8px;
    }

    @media (max-width: 768px) {
      .card-container {
        flex-direction: column;
        align-items: center;
      }

      select, input[type="datetime-local"], button {
        min-width: 90vw;
      }

      .controls {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>
<body>
  <h1 id="page-title">全球时间对照</h1>

  <div class="controls">
    <div class="time-controls">
      <input type="datetime-local" id="customTimeInput" />
      <button onclick="applyCustomTime()" id="btn-use-time">使用此时间</button>
      <button onclick="resetToNow()" id="btn-reset">恢复当前时间</button>
    </div>
    <div class="city-controls">
      <select id="city1"></select>
      <select id="city2"></select>
      <select id="city3"></select>
      <select id="city4"></select>
      <select id="city5"></select>
    </div>
    <div class="lang-control">
      <label for="lang">语言：</label>
      <select id="lang" onchange="changeLanguage()">
        <option value="zh">中文</option>
        <option value="en">English</option>
      </select>
      <button onclick="applyCities()" id="btn-update">更新城市</button>
    </div>
  </div>

  <div class="card-container" id="card-container"></div>

  <script>
    const translations = {
      zh: {
        pageTitle: "全球时间对照",
        useTime: "使用此时间",
        resetTime: "恢复当前时间",
        updateCities: "更新城市",
        baseTimeLabel: "当前标准时间",
        faster: "快",
        slower: "慢",
        than: "比",
        hour: "小时",
        cities: {
          "Beijing": "北京 🇨🇳",
          "Los Angeles": "洛杉矶 🇺🇸",
          "New York": "纽约 🇺🇸",
          "Tokyo": "东京 🇯🇵",
          "London": "伦敦 🇬🇧"
        }
      },
      en: {
        pageTitle: "World Time Comparison",
        useTime: "Use This Time",
        resetTime: "Reset to Now",
        updateCities: "Update Cities",
        baseTimeLabel: "Reference Time",
        faster: "ahead",
        slower: "behind",
        than: "than",
        hour: "hour(s)",
        cities: {
          "Beijing": "Beijing 🇨🇳",
          "Los Angeles": "Los Angeles 🇺🇸",
          "New York": "New York 🇺🇸",
          "Tokyo": "Tokyo 🇯🇵",
          "London": "London 🇬🇧"
        }
      }
    };

    let currentLang = 'zh';

    const rawCityList = {
      "Beijing": "Asia/Shanghai",
      "Los Angeles": "America/Los_Angeles",
      "New York": "America/New_York",
      "Tokyo": "Asia/Tokyo",
      "London": "Europe/London"
    };

    function getCityName(key) {
      return translations[currentLang].cities[key] || key;
    }

    function getCityKey(label) {
      for (const key in translations[currentLang].cities) {
        if (translations[currentLang].cities[key] === label) return key;
      }
      return label;
    }

    let selectedCities = Object.keys(rawCityList).slice(0, 5);

    function populateCitySelects() {
      for (let i = 1; i <= 5; i++) {
        const select = document.getElementById(`city${i}`);
        select.innerHTML = '';
        for (const key in rawCityList) {
          const option = document.createElement("option");
          option.value = key;
          option.textContent = getCityName(key);
          if (selectedCities[i - 1] === key) option.selected = true;
          select.appendChild(option);
        }
      }
    }

    function updateTime() {
      const baseDate = isCustomTime ? new Date(customTime) : new Date();
      const container = document.getElementById("card-container");
      container.innerHTML = '';
      const baseLang = translations[currentLang];

      const times = selectedCities.map((key, index) => {
        const tz = rawCityList[key];
        const formatter = new Intl.DateTimeFormat(currentLang === 'zh' ? 'zh-CN' : 'en-US', {
          timeZone: tz,
          hour12: false,
          weekday: 'long',
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit'
        });
        const parts = formatter.formatToParts(baseDate).reduce((acc, part) => {
          acc[part.type] = part.value;
          return acc;
        }, {});

        const localTime = new Date(baseDate.toLocaleString('en-US', { timeZone: tz }));
        const card = document.createElement("div");
        card.className = "time-card";
        card.innerHTML = `
          <h2>${getCityName(key)}</h2>
          <div class="date-info">${parts.year}-${parts.month}-${parts.day} ${parts.weekday}</div>
          <div class="time-display">${parts.hour}:${parts.minute}:${parts.second}</div>
          <div class="diff-info" id="diff-${index}"></div>
        `;
        container.appendChild(card);
        return localTime;
      });

      const baseTime = times[0];
      for (let i = 0; i < times.length; i++) {
        const diffMs = (times[i] - baseTime);
        const diffHours = Math.round(diffMs / 3600000);
        const target = document.getElementById(`diff-${i}`);
        if (i === 0) {
          target.textContent = baseLang.baseTimeLabel;
        } else {
          const direction = diffHours > 0 ? baseLang.faster : baseLang.slower;
          const diff = Math.abs(diffHours);
          target.textContent = `${baseLang.than} ${getCityName(selectedCities[0])} ${direction} ${diff} ${baseLang.hour}`;
        }
      }
    }

    let isCustomTime = false;
    let customTime = null;

    function applyCustomTime() {
      const input = document.getElementById("customTimeInput").value;
      if (!input) return;
      customTime = new Date(input);
      isCustomTime = true;
      updateTime();
    }

    function resetToNow() {
      isCustomTime = false;
      customTime = null;
      document.getElementById("customTimeInput").value = '';
      updateTime();
    }

    function applyCities() {
      selectedCities = [];
      for (let i = 1; i <= 5; i++) {
        selectedCities.push(document.getElementById(`city${i}`).value);
      }
      updateTime();
    }

    function changeLanguage() {
      currentLang = document.getElementById("lang").value;
      const langMap = translations[currentLang];
      document.getElementById("page-title").textContent = langMap.pageTitle;
      document.getElementById("btn-use-time").textContent = langMap.useTime;
      document.getElementById("btn-reset").textContent = langMap.resetTime;
      document.getElementById("btn-update").textContent = langMap.updateCities;
      populateCitySelects();
      updateTime();
    }

    document.addEventListener("DOMContentLoaded", () => {
      populateCitySelects();
      updateTime();
      setInterval(updateTime, 1000);
    });
  </script>
</body>
</html>