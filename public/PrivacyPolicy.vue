<script setup lang="ts">
import { ref, onMounted, computed } from 'vue'
import { NModal, NScrollbar } from 'naive-ui'
import { useDark } from '@vueuse/core'

const props = defineProps<{ show: boolean }>()
const emit = defineEmits<{ (e: 'update:show', val: boolean): void }>()

const isDark = useDark()
type Lang = 'zh' | 'en'
const currentLang = ref<Lang>('en')

onMounted(() => {
  const navLang = navigator.language || (navigator as any).userLanguage
  if (navLang.startsWith('zh')) {
    currentLang.value = 'zh'
  } else {
    currentLang.value = 'en'
  }
})

const handleClose = () => {
  emit('update:show', false)
}

const content = {
  zh: {
    title: 'æ˜Ÿäº‘ç¬”è®°éšç§æ”¿ç­–',
    updateDate: 'æ›´æ–°æ—¥æœŸï¼š2026 å¹´ 2 æœˆ 15 æ—¥',
    effectiveDate: 'ç”Ÿæ•ˆæ—¥æœŸï¼š2026 å¹´ 2 æœˆ 15 æ—¥',
    intro: 'â€œæ˜Ÿäº‘ç¬”è®°â€ï¼ˆä»¥ä¸‹ç®€ç§°â€œæˆ‘ä»¬â€ï¼‰æ·±çŸ¥ä¸ªäººä¿¡æ¯å¯¹æ‚¨çš„é‡è¦æ€§ã€‚æˆ‘ä»¬è‡´åŠ›äºä¿æŠ¤æ‚¨çš„éšç§ï¼Œå¹¶åœ¨æä¾›æœåŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œå°½é‡éµå¾ªâ€œæœ€å°å¿…è¦â€åŸåˆ™æ”¶é›†ä¿¡æ¯ã€‚',
    sections: [
      {
        title: 'ä¸€ã€ æˆ‘ä»¬æ”¶é›†çš„ä¿¡æ¯åŠç”¨é€”',
        items: [
          '**æ³¨å†Œä¿¡æ¯ï¼š** å½“æ‚¨æ³¨å†Œè´¦å·æ—¶ï¼Œéœ€æä¾›æ‰‹æœºå·ç æˆ–ç”µå­é‚®ç®±ã€‚è¿™æ˜¯ä¸ºäº†è¯†åˆ«æ‚¨çš„èº«ä»½ã€æ‰¾å›å¯†ç åŠä¿éšœè´¦å·å®‰å…¨ã€‚',
          '**å†…å®¹æ•°æ®ï¼š** è®¢é˜…VIPä¼šå‘˜åœ¨ç¬”è®°ä¸­è®°å½•çš„æ–‡å­—ã€å›¾ç‰‡ã€é™„ä»¶ç­‰ã€‚è¿™äº›æ•°æ®å­˜å‚¨åœ¨æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸Šï¼Œä»¥ä¾¿æ‚¨åœ¨ä¸åŒè®¾å¤‡é—´åŒæ­¥ã€‚æœªç»æ‚¨çš„æ˜ç¡®è®¸å¯ï¼Œæˆ‘ä»¬çš„äººå‘˜ä¸ä¼šæŸ¥çœ‹æ‚¨çš„ç¬”è®°å†…å®¹ã€‚',
          '**æŠ€æœ¯æ—¥å¿—ï¼š** ä¸ºä¼˜åŒ–æ€§èƒ½ï¼Œæˆ‘ä»¬ä¼šè‡ªåŠ¨æ”¶é›†è®¾å¤‡ä¿¡æ¯ï¼ˆå¦‚è®¾å¤‡å‹å·ã€æ“ä½œç³»ç»Ÿã€å”¯ä¸€è®¾å¤‡æ ‡è¯†ç¬¦ï¼‰ã€IP åœ°å€ã€æ“ä½œæ—¥å¿—ï¼ˆå¦‚é—ªé€€è®°å½•ã€æœç´¢è¯ï¼‰ã€‚',
          '**æ”¯ä»˜ä¿¡æ¯ï¼š** è‹¥æ‚¨è´­ä¹° VIP ä¼šå‘˜ï¼Œæˆ‘ä»¬ä¼šæ”¶é›†æ‚¨çš„äº¤æ˜“è®°å½•ä»¥æ ¸å¯¹è®¢å•ï¼Œä½†ä¸ä¼šå­˜å‚¨æ‚¨çš„é“¶è¡Œå¡æ•æ„Ÿä¿¡æ¯ã€‚'
        ]
      },
      {
        title: 'äºŒã€ æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨ Cookies',
        items: [
          'æˆ‘ä»¬ä½¿ç”¨ Cookies æ¥è®°ä½æ‚¨çš„ç™»å½•çŠ¶æ€ï¼Œé¿å…æ‚¨é¢‘ç¹è¾“å…¥å¯†ç ã€‚æ‚¨å¯ä»¥æ ¹æ®æµè§ˆå™¨è®¾ç½®æ‹’ç» Cookiesï¼Œä½†è¿™å¯èƒ½å¯¼è‡´éƒ¨åˆ†åŠŸèƒ½æ— æ³•æ­£å¸¸ä½¿ç”¨ã€‚'
        ]
      },
      {
        title: 'ä¸‰ã€ ä¿¡æ¯çš„åˆ†äº«ã€è½¬è®©ä¸æŠ«éœ²',
        items: [
          'æˆ‘ä»¬æ‰¿è¯ºä¸ä¼šå‘ä»»ä½•ç¬¬ä¸‰æ–¹å‡ºå”®æ‚¨çš„ä¸ªäººä¿¡æ¯ã€‚ä»…åœ¨ä»¥ä¸‹æƒ…å†µå¯èƒ½åˆ†äº«ï¼š',
          '**æ³•å¾‹è¦æ±‚ï¼š** æ ¹æ®æ³•å¾‹æ³•è§„ã€æ³•é™¢å‘½ä»¤æˆ–æ”¿åºœæœºå…³çš„å¼ºåˆ¶æ€§è¦æ±‚ã€‚',
          '**åˆå¹¶æ”¶è´­ï¼š** è‹¥å‘ç”Ÿåˆå¹¶ã€æ”¶è´­æˆ–èµ„äº§è½¬è®©ï¼Œæ‚¨çš„ä¿¡æ¯å°†ä½œä¸ºèµ„äº§çš„ä¸€éƒ¨åˆ†è¿›è¡Œè½¬ç§»ï¼Œæˆ‘ä»¬å°†è¦æ±‚æ–°æŒæœ‰äººç»§ç»­å±¥è¡Œéšç§æ‰¿è¯ºã€‚',
          // ğŸ‘‡ ä¿®å¤ç‚¹ï¼šç»™ URL åŠ ä¸Šäº† word-break: break-all æ ·å¼ï¼Œé˜²æ­¢æ‹‰ä¼¸ä¸Šä¸€è¡Œ
          '**ç¬¬ä¸‰æ–¹ SDKï¼ˆé«˜å¾·åœ°å›¾ï¼‰ï¼š** ä¸ºäº†å‘æ‚¨æä¾›â€œé»˜è®¤åŸå¸‚å®šä½â€ã€â€œè‡ªåŠ¨è·å–å¤©æ°”â€åŠâ€œä½ç½®æœç´¢â€åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦æ¥å…¥é«˜å¾·å¼€æ”¾å¹³å°å®šä½ SDKï¼ˆç”±é«˜å¾·è½¯ä»¶æœ‰é™å…¬å¸æä¾›ï¼‰ã€‚è¯¥ SDK å¯èƒ½ä¼šæ”¶é›†æ‚¨çš„è®¾å¤‡ä¿¡æ¯ï¼ˆå¦‚ IP åœ°å€ã€è®¾å¤‡æ ‡è¯†ç¬¦ã€æ“ä½œç³»ç»Ÿç‰ˆæœ¬ï¼‰ã€ä½ç½®ä¿¡æ¯ï¼ˆç»çº¬åº¦ï¼‰åŠç½‘ç»œçŠ¶æ€ã€‚æ‚¨å¯ä»¥è®¿é—® <span style="word-break: break-all; color: #6366f1;">https://lbs.amap.com/pages/privacy/</span> äº†è§£å…¶éšç§æ”¿ç­–ã€‚'
        ]
      },
      {
        title: 'å››ã€ æ•°æ®å­˜å‚¨ä¸å®‰å…¨ä¿æŠ¤',
        items: [
          '**å­˜å‚¨åœ°ç‚¹ï¼š** æˆ‘ä»¬åœ¨ä¸­åäººæ°‘å…±å’Œå›½å¢ƒå†…æ”¶é›†çš„ä¿¡æ¯å°†å­˜å‚¨äºä¸­å›½å¢ƒå†…ã€‚',
          '**å®‰å…¨æªæ–½ï¼š** æˆ‘ä»¬ä½¿ç”¨åŠ å¯†æŠ€æœ¯ï¼ˆå¦‚ SSL/TLSï¼‰ã€å»æ ‡è¯†åŒ–å¤„ç†ç­‰æ‰‹æ®µä¿æŠ¤æ•°æ®å®‰å…¨ã€‚',
          '**ä¿ç•™æœŸé™ï¼š** æˆ‘ä»¬ä»…åœ¨æä¾›æœåŠ¡æ‰€å¿…éœ€çš„æœŸé™å†…ä¿ç•™æ‚¨çš„ä¿¡æ¯ã€‚å¦‚æœæ‚¨æ³¨é”€è´¦æˆ·ï¼Œæˆ‘ä»¬å°†æ ¹æ®æ³•å¾‹è¦æ±‚å¯¹æ•°æ®è¿›è¡Œåˆ é™¤æˆ–åŒ¿ååŒ–å¤„ç†ã€‚'
        ]
      },
      {
        title: 'äº”ã€ æ‚¨çš„æƒåˆ©',
        items: [
          'æ‚¨å¯¹è‡ªå·±çš„ä¸ªäººä¿¡æ¯æ‹¥æœ‰å……åˆ†çš„æ§åˆ¶æƒï¼š',
          '**è®¿é—®ä¸æ›´æ­£ï¼š** æ‚¨å¯ä»¥åœ¨åº”ç”¨è®¾ç½®ä¸­æŸ¥çœ‹å¹¶ä¿®æ”¹ä¸ªäººèµ„æ–™ã€‚',
          '**å¯¼å‡ºï¼š** æˆ‘ä»¬æä¾›æ•°æ®å¯¼å‡ºåŠŸèƒ½ï¼Œæ‚¨å¯ä»¥è·å–è‡ªå·±çš„ç¬”è®°å‰¯æœ¬ã€‚',
          '**åˆ é™¤ï¼š** æ‚¨å¯ä»¥éšæ—¶åˆ é™¤å•æ¡ç¬”è®°æˆ–ç”³è¯·æ³¨é”€è´¦å·ã€‚',
          '**æ’¤å›æˆæƒï¼š** æ‚¨å¯ä»¥é€šè¿‡æ‰‹æœºç³»ç»Ÿè®¾ç½®å…³é—­æ‘„åƒå¤´ã€ç›¸å†Œç­‰æƒé™ã€‚'
        ]
      },
      {
        title: 'å…­ã€ éšç§æ”¿ç­–çš„ä¿®è®¢',
        items: [
          'æˆ‘ä»¬å¯èƒ½ä¼šé€‚æ—¶ä¿®æ”¹æœ¬æ”¿ç­–ã€‚é‡å¤§å˜æ›´æ—¶ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡ç«™å†…ä¿¡æˆ–å¼¹çª—é€šçŸ¥æ‚¨ã€‚è‹¥æ‚¨ç»§ç»­ä½¿ç”¨â€œæ˜Ÿäº‘ç¬”è®°â€ï¼Œå³è¡¨ç¤ºæ‚¨åŒæ„æ¥å—ä¿®è®¢åçš„æ”¿ç­–ã€‚'
        ]
      },
      {
        title: 'ä¸ƒã€ è”ç³»æˆ‘ä»¬',
        items: [
          'å¦‚æœæ‚¨å¯¹éšç§ä¿æŠ¤æœ‰ä»»ä½•ç–‘é—®ã€æ„è§æˆ–æŠ•è¯‰ï¼Œè¯·è”ç³»æˆ‘ä»¬ï¼š',
          'é‚®ç®±ï¼š**ming@woabc.com**'
        ]
      }
    ]
  },
  en: {
    title: 'Nebula Notes Privacy Policy',
    updateDate: 'Updated: Feb 15, 2026',
    effectiveDate: 'Effective: Feb 15, 2026',
    intro: 'At Nebula Notes ("We"), we recognize the importance of your personal information. We are committed to protecting your privacy and collecting information under the principle of "minimum necessity".',
    sections: [
      {
        title: '1. Information We Collect & Usage',
        items: [
          '**Registration:** When you register, we collect your phone number or email to identify you, assist in password recovery, and ensure account security.',
          '**Content Data:** For VIP members, text, images, and attachments recorded in notes are stored on our servers for multi-device sync. We do not access your content without explicit permission.',
          '**Technical Logs:** To optimize performance, we collect device info (model, OS, unique ID), IP address, and operation logs (crashes, search terms).',
          '**Payment Info:** If you purchase VIP, we collect transaction records to verify orders, but we do not store sensitive bank card information.'
        ]
      },
      {
        title: '2. How We Use Cookies',
        items: [
          'We use Cookies to remember your login status and preferences. You can disable Cookies via browser settings, but some features may not function properly.'
        ]
      },
      {
        title: '3. Sharing, Transfer & Disclosure',
        items: [
          'We promise not to sell your personal information to third parties. Sharing only occurs under these conditions:',
          '**Legal Requirements:** Compliance with laws, court orders, or mandatory government requests.',
          '**Mergers & Acquisitions:** In the event of a merger or asset transfer, your info will be moved as part of the assets, and we will require the new holder to honor this privacy commitment.',
          '**Third-Party SDK (AMap/Gaode):** To provide "Default City Location", "Auto Weather", and "Location Search" features, we integrate the AMap Location SDK provided by AutoNavi Software Co., Ltd. This SDK may collect your device information (e.g., IP address, Device ID, OS version), location data (latitude/longitude), and network status. Please refer to their privacy policy at https://lbs.amap.com/pages/privacy/.'
        ]
      },
      {
        title: '4. Data Storage & Security',
        items: [
          '**Location:** Information collected within the PRC will be stored on servers located in China.',
          '**Security:** We use encryption (e.g., SSL/TLS) and de-identification to protect your data.',
          '**Retention:** We retain info only as long as necessary for the service. Upon account deletion, data will be deleted or anonymized according to legal requirements.'
        ]
      },
      {
        title: '5. Your Rights',
        items: [
          'You have full control over your personal information:',
          '**Access & Correct:** View and modify your profile in app settings.',
          '**Export:** Use the data export feature to get a copy of your notes.',
          '**Delete:** Delete individual notes or apply for account cancellation at any time.',
          '**Revoke Permissions:** Disable camera or album access via your device system settings.'
        ]
      },
      {
        title: '6. Amendments',
        items: [
          'We may update this policy periodically. Significant changes will be notified via in-app messages or pop-ups. Continued use implies acceptance of the revised policy.'
        ]
      },
      {
        title: '7. Contact Us',
        items: [
          'If you have questions, comments, or complaints regarding privacy, please contact us:',
          'Email: **ming@woabc.com**'
        ]
      }
    ]
  }
}

const activeContent = computed(() => content[currentLang.value])

const parseBold = (text: string) => {
  return text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
}
</script>

<template>
  <NModal
    :show="props.show"
    :mask-closable="true"
    :auto-focus="false"
    :z-index="5020"
    @update:show="val => emit('update:show', val)"
  >
    <div class="modal-wrapper" :class="{ 'is-dark': isDark }">
      <header class="modal-header">
        <h2 class="title">{{ activeContent.title }}</h2>
        <button class="close-btn" @click="handleClose">&times;</button>
      </header>

      <NScrollbar class="modal-body" style="flex: 1 1 auto; min-height: 0; overflow: hidden;">
        <div class="content-padding">
          <div class="meta-info">
            <p>{{ activeContent.updateDate }}</p>
            <p>{{ activeContent.effectiveDate }}</p>
          </div>

          <div class="intro-box">
            <p>{{ activeContent.intro }}</p>
          </div>

          <section v-for="(section, index) in activeContent.sections" :key="index" class="section-block">
            <h3>{{ section.title }}</h3>
            <ul>
              <li v-for="(item, i) in section.items" :key="i" v-html="parseBold(item)"></li>
            </ul>
          </section>

          <div class="end-copyright">
            Â© 2026 Nebula Notes. All rights reserved.
          </div>
        </div>
      </NScrollbar>
    </div>
  </NModal>
</template>

<style scoped>
.modal-wrapper {
  width: 100vw;
  height: 100vh;
  height: 100dvh;
  background: #ffffff;
  color: #333;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* âœ… æ ¸å¿ƒä¿®æ”¹ï¼šåŠ å¤§å¤´éƒ¨ padding-top */
.modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 20px;
  
  /* âš¡ï¸ å…³é”®ï¼šç¦»åˆ˜æµ·æ›´è¿œä¸€ç‚¹ */
  padding-top: calc(env(safe-area-inset-top) + 20px); 
  
  border-bottom: 1px solid rgba(0,0,0,.06);
  flex: 0 0 auto;
}

.title {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
  color: #1a1a1a;
}

.close-btn {
  background: none;
  border: none;
  font-size: 28px;
  cursor: pointer;
  padding: 0;
  line-height: 1;
  color: #666;
  width: 40px;
  text-align: right;
  display: flex;
  align-items: center;
  justify-content: flex-end;
}

/* æ»šåŠ¨å†…å®¹åŒº */
.content-padding {
  padding: 20px;
  max-width: 800px;
  margin: 0 auto;
  /* âœ… å› ä¸ºåˆ é™¤äº†é¡µè„šï¼Œå¢åŠ åº•éƒ¨ç•™ç™½ */
  padding-bottom: max(40px, env(safe-area-inset-bottom));
}

.meta-info {
  text-align: center;
  font-size: 12px;
  color: #888;
  margin-bottom: 20px;
}
.meta-info p { margin: 2px 0; }

.intro-box {
  background-color: #f0f7ff;
  border-radius: 8px;
  padding: 14px 16px;
  margin-bottom: 24px;
  color: #2c5282;
  font-size: 14px;
  border-left: 4px solid #4299e1;
}

h3 {
  font-size: 16px;
  margin: 20px 0 10px;
  font-weight: 700;
  color: #000;
}

ul {
  padding-left: 16px;
  margin: 0;
}

li {
  margin-bottom: 8px;
  font-size: 14px;
  line-height: 1.6;
  color: #444;
  text-align: justify;
}

li :deep(strong) { color: #000; }

.end-copyright {
  margin-top: 40px;
  text-align: center;
  font-size: 12px;
  color: #bbb;
}

/* Dark Mode */
.modal-wrapper.is-dark {
  background: #101014;
  color: #e0e0e0;
}

.modal-wrapper.is-dark .modal-header {
  border-bottom-color: rgba(255,255,255,.08);
}

.modal-wrapper.is-dark .title { color: #fff; }
.modal-wrapper.is-dark .close-btn { color: rgba(255,255,255,0.6); }

.modal-wrapper.is-dark .meta-info { color: #888; }

.modal-wrapper.is-dark .intro-box {
  background-color: rgba(66, 153, 225, 0.15);
  color: #90cdf4;
  border-left-color: #4299e1;
}

.modal-wrapper.is-dark h3 { color: #fff; }

.modal-wrapper.is-dark li { color: #ccc; }
.modal-wrapper.is-dark li :deep(strong) { color: #fff; }
</style>