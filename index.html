<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="/logo.jpg" />

    <!-- 视口与 iOS 全屏 -->
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <title>我abc网址导航：简洁高效的自定义网址导航站</title>

    <!-- PWA 基础 -->
    <meta name="theme-color" content="#111111" />
    <link rel="manifest" href="/manifest.webmanifest" />

    <!-- 图标 -->
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-180.png" sizes="180x180" />
    <link rel="apple-touch-icon" href="/favicon.ico" />
    <link rel="icon" href="/favicon.ico" />
    <link rel="icon" type="image/jpeg" href="/logo.jpg" />

    <meta name="keywords" content="我abc网址导航,网址大全,网址站,网址大全,冷门网站,工具导航,收藏夹" />
    <meta
      name="description"
      content="一款简洁、干净、无广告的浏览器起始页。支持高度自定义布局、多款精美主题和强大的站内搜索功能，帮助您轻松管理常用网站，提升上网效率。"
    />

    <!-- 首屏视口兜底（可配合 CSS 使用 var(--vh)） -->
    <script>
      (function setVH() {
        var h = (window.visualViewport ? visualViewport.height : window.innerHeight) * 0.01;
        document.documentElement.style.setProperty('--vh', h + 'px');
      })();
      window.addEventListener('resize', function () {
        var h = (window.visualViewport ? visualViewport.height : window.innerHeight) * 0.01;
        document.documentElement.style.setProperty('--vh', h + 'px');
      });
      window.addEventListener('orientationchange', function () {
        var h = (window.visualViewport ? visualViewport.height : window.innerHeight) * 0.01;
        document.documentElement.style.setProperty('--vh', h + 'px');
      });
    </script>

    <!-- 仅首页使用：为被标记的顶栏应用 safe-top（加 !important 保证覆盖原样式） -->
    <style>
      html, body, #app { margin: 0; }
      @supports (top: env(safe-area-inset-top)) {
        body.__home_fs .__safeTop {
          top: env(safe-area-inset-top) !important;
        }
      }
    </style>

    <!-- 首页 + 全屏：自动标记顶栏，离开首页即还原 -->
    <script>
      (function () {
        var isStandalone =
          (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) ||
          window.navigator.standalone === true;

        function isHomePath() {
          return location.pathname === '/' || location.pathname === '/index.html' || location.pathname === '';
        }

        function markHeaders(apply) {
          // 选取常见顶栏：header/导航条/顶部条；必要时可把你首页顶栏的类名补进来
          var nodes = document.querySelectorAll(
            'header, .header, .site-header, .app-header, .topbar, .top-bar, .navbar, [role="banner"], [data-fixed-header], [data-sticky-header]'
          );
          nodes.forEach(function (el) {
            var cs = getComputedStyle(el);
            var isFixedOrSticky = cs.position === 'fixed' || cs.position === 'sticky';
            // 顶在最上面的才需要补偿（top:0 或没有设置 top）
            var need = isFixedOrSticky && (cs.top === '0px' || cs.top === 'auto' || cs.top === '0');
            if (apply && need) {
              el.classList.add('__safeTop');
            } else {
              el.classList.remove('__safeTop');
            }
          });
        }

        function update() {
          var shouldApply = isStandalone && isHomePath();
          document.body.classList.toggle('__home_fs', shouldApply);
          markHeaders(shouldApply);
        }

        // 监听 SPA 路由变化：覆盖 pushState/replaceState，并监听 popstate
        (function hookHistory() {
          ['pushState', 'replaceState'].forEach(function (k) {
            var orig = history[k];
            history[k] = function () {
              var ret = orig.apply(this, arguments);
              setTimeout(update, 0);
              return ret;
            };
          });
          window.addEventListener('popstate', function () { setTimeout(update, 0); });
        })();

        document.addEventListener('DOMContentLoaded', function () {
          update();
          // App 挂载、布局/旋转后再试一次（确保渲染完成后能抓到顶栏）
          setTimeout(update, 0);
          window.addEventListener('resize', update);
          if (window.visualViewport) visualViewport.addEventListener('resize', update);
        });
      })();
    </script>
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>